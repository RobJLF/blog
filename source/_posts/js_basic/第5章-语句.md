---
title: 犀牛-第5章-语句
permalink: 语句
date: "2019/7/15"
mathjax: true
tags: 
- JS
- 犀牛书
categories: JS
---
## 第5章-语句

表达式计算出一个值，语句则用来执行以使某件事发生。一个JavaScript程序无非就是语句们以分号分隔的集合。
## 5.1表达式语句

具有副作用的表达式是JavaScript最简单的语句，在第4章讲过。赋值语句就是最常见的表达式语句。

```js
greeting = "hello"+name;
i *= 3;
delete o.x;
alert(greeting);
window.close();
```

调用没有副作用的函数一般是没有意义的。如`Math.cos(x)`

## 5.2复合语句和空语句

可以用逗号将几个表达式连接起来，形成一个表达式；也可以用花括号`{}`将多条语句括起来，形成一条复合语句。

```js
{
x = Math.Pr;
cx = Math.cos(x);
consoel.log("cos(pi)="+cx);
}
语句块后面不需要分号
```

空语句：`;`可以放在for循环后面表示空的循环体，但一般不这么干，如果这么写了记得加注释说明。

## 5.3声明语句

var和function都是声明语句，用于声明变量和函数。更多细节这里不说了。

### 5.3.1 var

var 语句声明 一个或多个变量，语法如下:

```js
初始化是可选操作。
var name_1 [=value_1][,...,name_n][=value_n]
```

1. var出现在函数体内则声明局部变量，作用域为这个函数；var 出现在顶层代码中则声明全局变量，全局变量是全局对象window的属性，不过通过var声明的全局属性是无法delete的；没有用var声明的全局属性是可delete的
2. var声明时没有初始化的变量值为undefined；切记变量声明会被提前到函数顶部(3.10.1),但是初始化操作留在var语句的位置（for中的var也会提前到for循环外）
3. 多次声明同一个变量是没有意义的，无所谓的。

### 5.3.2 function

1. 分为函数声明语句和函数定义表达式

    ```js
    var f = function() {}//表达式
    function f(){}//声明 f是一个函数名也是变量名，指向此函数对象
    ```

2. 声明和定义并不会执行函数体内的语句

3. 函数定义表达式必须出现在顶层或者嵌套函数顶部，函数声明表达式则不介意这些

4. 函数声明同var定义变量一样会提前声明，但是其初始化也会提前；函数定义表达式(var c=function(){})只有声明提前，初始化留在原地，这点表现的和var一致。

## 5.4条件语句

条件语句是指通过判断指定表达式的值来决定执行还是跳过某些语句。

### 5.4.1 if

```js
如果计算expression的值为真值，则执行statement；否则为假值不执行。
if(expression)
  statement

如果计算expression的值为真值，则执行statement1；否则为假值执行statement2。
if(expression)
  statement1
else
  statement2
```

else总是和就近的if语句匹配

### 5.4.2 else if

if/else语句是通过判断表达式然后在两条分支中选择一条进行执行；而使用else和if的就近匹配规则可以在else语句中嵌套if/else语句来达到多分支的效果。

```js
if(exp){
}
else if(exp){
}
else if(exp){
}
else{
}
```

### 5.4.3switch

else if的嵌套使用可以达到多分支选择的效果；但是结构上较为复杂，且如果说所有的分支有依赖于同一条表达式的值，那么该表达式会重复的在每条if中计算，此时使用switch是更适合的解决办法。

```js
switch(expression) {
  case exp: statement; break;
  case exp: statement; break;
  case exp: statement; break;
  default: statement; break;
}
break语句可以使解释器跳出switch语句或者循环语句。
```

1. 步骤：先计算出switch表达式的值，然后从上往下计算一个case表达式的值，如果说两者严格相等(`===`)，那么进入该case节点，并从上往下执行语句(没有break则会执行所有case和default)；否则计算下一个case表达式。如果没有case表达式与switch表达严格相等，进入default节点，然后从上往下执行语句(default可以不用放在最后)。
2. 并不是所有的case表达式都会执行
3. JavaScript中的case是运行时计算的，可以不是常量(但是最好还是使用常量)；而C C++ Java中的case表达式是编译时计算的同类型常量，而且会编译一个跳转表，使得switch语句特别高效。

## 5.5 循环(while do/while for for/in)

### 5.5.1 while

```js
while(expression){
  statement;
}
expression如果为假值跳出循环；为真值执行表达式并再次判断expression的值，以此循环。
```

### 5.5.2 do while

```js
do
  statement
while(expression);
```

与while相比：

1. 判断在语句底部，所以必定执行一次statement
2. 末尾有分号

### 5.5.3 for

1. for循环自带三个表达式，分别表示初始化、循环条件判断和计数器变量的更新
（可以有逗号运算符比如var i=0,j=0;test;i++, j++）
2. for循环的三个表达式都可以省略，但是两个分号不能省略；如果说省略了test语句，那么for变成死循环(for(;;))

```js
for(initialize; test; increment)
  statement

基本上等价的while语句
initialize;
while(test) {
  statement;
  increment;
}
如果说使用了continue语句，那么while中的statement语句可以被跳过，但是for中的increase则不会跳过
```

### 5.5.4 for/in

```js
variable是返回左值的表达式(一般是变量)
object是返回对象类型的表达式
for (variable in object) {
  statement;
}
```

1. 判断逻辑：先计算object表达式，如果为null undefined则跳出循环；如果是原始值，转换为包装类；否则object本身指向对象。然后JavaScript枚举该对象属性名(字符串)，并在每次循环开始前计算variable表达式的值(所以会多次计算)，并将该属性名赋值给表达式返回值。
2. 数组的索引也是属性，会被枚举
3. 枚举范围：可继承、可枚举属性
4. 如果说循环的statement删除了还没有枚举的属性，那么该属性不会再被枚举；如果定义了新属性，这些属性通常不会枚举到(有一些引擎可以枚举增加的继承属性)

**枚举顺序**

1. ES5没有指定以何种顺序枚举对象属性。实际上主流的方式是按照属性定义的顺序枚举。

2. 一下情况枚举顺序取决于具体实现

- 对象继承了可枚举属性
- 对象具有整数数组索引的属性
- 使用delete删除对象已有属性
- 使用Object.defineProperty()或类似的方法改变了对象的属性

## 5.6跳转

使得JavaScript执行可以从一个位置跳转到另一个位置.

1. break:跳转到循环或者其他语句的结束处
2. continue:终止本次循环,进入下一次循环的执行
3. 语句可以进行命名, break continue都可以标识当前循环或者其他语句标签
4. return语句跳出函数执行
5. throw语句抛出异常,一般和try/catch/finally语句一起使用。抛出异常的时候，程序会跳转到最近的闭合异常处理程序，可以在当前函数中，也可以更高层的调用栈中。

### 5.6.1标签语句

语句是可以添加标签的:

```js
identifier: statement
```

1. 只有break和continue可以使用标签
2. identifier必须是合法的标识符，它的命名空间和变量函数名不同，所以可以与变量函数名重名。
3. 语句标签只在它作用的语句内有定义，所以不能和它内部的语句标签重名，但是在不相互嵌套的情况下可以出现同名标签
4. 语句可以多标签

### 5.6.2 break语句

1. 不带标签的break：跳出就近的循环或者switch语句
2. 带标签的break：`break labelname;`跳转labelname标签表示的外部语句块的结束处，可以是任何闭合的语句块，不在只能是循环和switch（一般用于跳出多层循环）。之间不能换行
3. break带不带标签都无法跳出函数体(不能出现在函数体的顶层)

### 5.6.3 continue语句

1. 用处跳出此次循环，进入下一次循环
2. 同break一样可以带标签或者不带标签，但是无论是哪种情况都只能放在循环体内使用，否则会报错
3. continue执行后，不同类型的循环中的跳转稍有不同
   - while：重新检测expression
   - do/while:重新检测expression
   - for：先计算自增表达式，然后再检测test表达式
   - for/in：遍历下一个属性名并赋值给指定表达式返回值
4. continue时while和for的区别就在于for多了一个increment表达式。
5. 带标签continue用在嵌套循环中调出多层循环；同break一样不能在continue和labelname之间换行

### 5.6.4 return语句

`return expression;`

1. return只能出现在函数体内，否则报错
2. return后没有表达式，返回undefined
3. 函数没有return，那么只是简单的执行内部的语句，返回undefined
4. 切记return和expression之间不要换行

### 5.6.5 throw语句

所谓异常就是指某种异常情况或者错误时产生的信号。抛出异常就是通知发生了错误，捕获异常就是处理这个错误。
JavaScript中通过throw语句来抛出异常，使用try/catch/finally来捕获异常

```js
throw expression;
```

1. expression可以是任何类型的表达式，当然JavaScript抛出的异常通常采用Error类型或者其子类型。
2. 一个Error对象包含name属性表示错误类型，一个message属性用于描述错误(可以通过Error()构造函数赋值message)
3. 抛出异常后，JavaScript解释器立即停止当前正在执行的逻辑，并跳转到就近的异常处理程序，异常处理程序就是用try/catch/finally语句的catch从句书写的。
4. 如果当前没有catch从句，则会将异常向外抛，即往更高的闭合代码块和函数调用栈抛。如果没有任何的处理程序，那么JavaScript将异常当做程序错误处理，并报告给用户。

### 5.6.6 try/catch/finally语句

try/catch/finally语句是JavaScript的异常处理机制。

1. try中定义需要处理的异常所在的代码；在try中发生异常时调用catch从句内的代码逻辑；finally中放入清理代码，无论是否有异常，finally块内的逻辑均会执行。
2. catch和finally是可选的，但是必须二选一组成完整语句
3. 花括号是必须有的

```js
try{
  //通常来讲，这里的代码执行时不会报错
  //但有时会抛出异常：1.通过throw直接抛出 2.调用方法间接抛出
}
catch(e){
  //当try中语句块抛出异常，执行这里的代码
  //可以通过局部变量e来获取Error对象或者抛出的其他值
    //但是这个e是块级作用域，在catch之内才有定义
  //这里可以：1.处理异常 2.忽略异常 3.通过throw再次抛出异常 
}
finally{
  //无论try中是否有异常，这里都会执行
    //终止try语句块的方式：
  //1.正常终止，及执行每一条语句
  //2.通过break，continue或return语句
  //3.抛出异常，被catch捕获
  //4.抛出异常，没有被捕获，继续向外抛
}
```

1. 没有异常抛出，那么执行完try便执行finally；如果异常抛出，则先执行catch中的语句在执行finally，没有catch的话则先执行finally再向外抛处异常
2. finally中的throw会覆盖之前抛出的异常，finally中return会忽略之前抛出的异常，覆盖try/catch的return值，然后让函数正常返回。

```js
var foo = function(){
  try{
    //抛出异常
  }
  finally{
    return 1；//函数正常返回，忽略向外抛出异常
  }
}
```

3. 使用try/finally语句可以让while正确模拟continue的for循环：

```js
initialize;
while(test) {
  try{statement};
  finally{increment;}
}
这时statement中即使有continue，也会执行increment了，和for循环一致。
但是statement中有break，也会执行increment，这和for循环不一致，因为此时for循环中不执行increment
```

## 5.7 其他与句

with、debugger、use strict

### 5.7.1  with语句

with语句用于临时扩展作用域链，严格模式中不能使用，最好也不要用

```js
将object添加到作用域链的顶部，然后执行statement，最后恢复作用域链
width(object)
  statement

可用于简化代码：比如访问HTML表单中的元素
document.forms[0].address.value
可以简化为
width(document.forms[0]) {
  name.value = "";
  address.value = "";
  email.value = "";
}
这样便可以不用再写dmeocunt.forms[0]这个前缀

不用with语句可以将document.forms[0]赋值给变量达到简化效果
var f = document.forms[0];
f.name.value = ""

切记：with语句只是读取属性的简便方式(可以赋值)，不能创建属性
```

### 5.7.2 debugger语句

debugger语句用于产生断点，方便调试代码(F12下才起作用)

### 5.7.3 "use strict"

"use strict"是一条指令，不是语句，用于开启严格模式。

- 指令：不包含任何的关键字，只是一个包含特殊字符串直接量的表达式；出现在代码的开始或者函数体的开始处、任何实体语句之前，当不一定是第一行，因为起之前只有都可以有其他字符串直接量表达式；JavaScript具体实现将他们解析为解释器自有的指令；第一条常规语句之后的字符串直接量语句只会当做普通的语句对待。
- 具体有哪些限制看书

## 5.8 JavaScript语句小节

看书
