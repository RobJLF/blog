---
title: ieee-745浮点数
permalink: ieee_745_float
date: "2018/11/12"
mathjax: true
tags: ieee-754浮点数
categories: 计算机
---

## 浮点数

参考博客：[**ieee 754浮点数表示标准**](https://www.cnblogs.com/german-iris/p/5759557.html)  [程序员必须知道的浮点运算原理](https://blog.csdn.net/tercel_zhang/article/details/52537726)
Reference：

1. http://steve.hollasch.net/cgindex/coding/ieeefloat.html
2. https://en.wikipedia.org/wiki/IEEE_754-1985

## 10进制和2进制的科学进制转换

10进制转2进制中，对于小数点以前的值除以2，小数点以后的值除以1/2，且小数点后的值有可能是除不尽的，也就是说会有误差。
$$(3.3)_{10}=(11.11)_2=1.111 \times 2^1$$
<!-- more -->
## IEEE 754标准下的存储策略

ieee标准下的浮点数存储包含三个基本的组成：符号位、指数、尾数，尾数是由小数部分和一个隐含的前导数位组成(一般是1)。至于前导数位隐含的原因之后再提。

下面的表格展示了单精度和双精度浮点数的bit结构

|类型|符号位|指数位|尾数位|有效位数|指数偏移|
|:---|:---|:---|:---|:---|:---|
|单精度|1 [31]|8 [30 - 23]|23 [22 - 0]|24|127|
|双精度|1 [63]|11 [62 - 52]|52 [51 - 0]|53|1023|

![float2](/blog/images/float_2.png)
![float3](/blog/images/float_3.png)

- 符号位
位于浮点数存储的最高比特，只占有1个bit。0表示正数，1表示负数。
- 指数位
因为指数位既可以是正值也可以是负值，所以为了做到这一点引入了偏移量。对于IEEE标准下的单精度浮点数，偏移量是127，也就是说原本的指数值为8位，取值范围应该是0 - 255，带上偏移量之后代表的数学意义是-127 - 128（双精度浮点数偏移量为1023 范围-1023 - 1024）
- 尾数
尾数也可以说是有效位数，决定浮点数的精确度。它由隐含得前导数位（整数部分）和小数部分组成，因为我们使用的是2为底的科学计数法，所以前导数位固定为1，所以我们不需要明确的表示出来。同时尾数也代表着浮点数可以表示的整数的取值范围($2^{24}$和$2^{53}$)

## 浮点数存储实例

十进制数$0.15625_{10}$写成二进制的形式为$0.00101_2$通过乘以以2为底的指数，将小数点向右移动3位后得到$$0.00101_2 = 1.01_2 \times 2^{-3}$$
这个时候我们便能确定它的尾数的小数部分和指数部分分别为多少了，见如下如：

> ![float](/blog/images/float.png)

- sign = 0, 因为该浮点数为正数（用1表示负数）
- 真实的指数是-3，但是我们用来存储的指数要在真实的指数上加上偏移量。在单精度浮点数中，这个偏移量是127，在双精度浮点数中这个偏移量是1023；所以我们这里用来存储的指数应该为（-3+127），即124

## 浮点数的范围

以double为例，无误差整数范围为$\pm 2^{53}$超过此范围将无法保证精度。有误差小数最大值$\pm (2-2^{-52})\times 2^{1023}$ 最小值$\pm 2^{-52}\times 2^{-1022}$

## 特殊值

```js
1. 最小值指数（所有位全置0）用于定义0和弱规范数

2. 最大指数（所有位全值1）用于定义$\pm \infty$和NaN（Not a Number）

3. 其他指数用于表示常规的数。
```

这样一来，最大（指绝对值）常规数的指数不是全1的，最小常规数的指数也不是0，而是1。`

- 零
按照上面浮点数的表示方法，我们会发现无法表示0值。因为我们认为前导数位值默认为1。为此，我们规定当指数全部为0(-127)且尾数的小数全部为0时，这个时候浮点数的值为0。注意+0和-0是两个不同的浮点数，即使他们的数值一样，但是浮点数的表示方式不一样。

- 非标准化的值
当指数全部为0，但是小数不全部为0时，这个时候的浮点数表示的值就是非标准化的值。这个时候我们认为浮点数的前导数位为0。因为标准化所能表示的最小值是$(−1)^s × 1 × 2^{−126}$和$(−1)^s × 1× 2^{−1022}$，这样可以使得我们能够表达更小的值，提高精确度。注意这个时候的单精度浮点数大小为$(−1)^s × 0.f × 2^{−126}$，双精度浮点数的大小为$(−1)^s × 0.f × 2^{−1022}$，其中s为符号位上的数值，2为底的指数分别是-126和-1022，而不是-127和-1023。（这样这才能与指数位为1时的值连接，否则会产生空区间）

- 无穷大值
当指数位全部为1，而尾数的小数部分全部为0时表示$\pm \infty$,通过符号位来区分。

- 非数字
NaN用来表示非数字的值，当指数为全部为1且尾数的小数部分不为0时表示NaN值。一共有两种NaN值，静态非数（QNaN）和警告非数（SNaN）。
如果小数部分首位为1，表示QNaN。通常表示不被数学上定义的运算结果，比如除数为零时的时候。
如果小数部分首位为0，表示SNaN。表示操作中的一个异常，可以用来表示一个未被初始化变量的过早使用。
